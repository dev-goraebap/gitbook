---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: false
---

# 라이브러리 기획 및 설계

### 인증 기능

애플리케이션에서 대부분 사용하게 되는 인증에 대한 구현을 간소화하는 목적.

1. 아이디/패스워드 방식의 로그인:
   1.  &#x20;기본적으로는 아이디/패스워드 입력시 토큰을 발행하는 것을 기본으로 하지만, 그 외의 값들도 필요시 입력받을 수 있도록 해야함 ->&#x20;

       내부에 기본으로 구현되는 credential model 클래스 타입을 검증하도록 하고 필요시 외부에서 이 클래스를 확장하여 등록하도록 함.
   2.  토큰을  발행하는 것은 동일한 절차이지만, 과정은 개발자가 요구사항에 맞게 구현해야함.

       \-> 인증 전략 인터페이스를 구현하는 클래스를 개발자가 직접 만들게 하기
   3.  토큰은 jwt 형태의 토큰이기 때문에 jwt 인증, 리프레시 토큰을 발급해주는 서비스 필요&#x20;

       \-> 외부에서 jwt 인증, 리프레시의 secret 키와 만료일자를 등록할 수 있게 하기

       \-> nestjs/jwt 모듈을 사용&#x20;
   4. jwt 토큰 인증 기능 필요
      1. 엑세스토큰이 들어왔을 경우 엑세스토큰을 검증하는 가드 필요
      2. 리프레시토큰이 들어왔을 경우 리프레시 토큰을 검증하는 가드 필요
2. oauth2 로그인:
   1. third party 인증에 필요한 리소스를 등록할 수 있는 옵션, 레지스터 필요. 개발자들이 설정에서 정보를 등록해놓으면 인증 전략 클래스들에서 쉽게 가져다 쓸 수 있게 하기.
   2.  third party 의 로그인 페이지로 리다이랙트 하는 기능 필요.&#x20;

       \-> 클라이언트 측 (웹, 안드로이드, IOS) 에서 로그인 페이지를 직접 요청해도 상관 없지만, 서버에서 로그인 페이지 URI를 관리
   3.  third party 로그인 성공시 요청한 code 값을 가지고 인증 토큰 리소스를 발급하는 기능 필요

       \-> 발급하는 과정은 개발자가 구현하지만, 인증 전략 인터페이스를 만들어서 구현하도록 함&#x20;

       \->  인터페이스를 활용하는 클래스들은 third party 와 통신하기 위해 99% http 관련 기술을 사용해야함. -> nestjs 의 공식 통신모듈 nestjs/axios 를 사용하도록 강요하고 유틸 기능으로 좀 더 편하게 쓸 수 있게 해야함
   4. third party 리소스 요청 -> 인증 토큰을 클라이언트가 가지고 있을 경우 토큰으로 (어떤) 리소스를 요청할 수 있게 해야함. 리소스 요청을 특정할 수 가 없음. 요구사항에 따라 받아오는 정보가 다르기 때문에 이부분은 개발자가 third party strategy 클래스에 추가적으로 기능을 명시하고 코드 구현 레벨에서 사용하도록 하는게 맞는거 같음 -> 라이브러리에서 관리하지 않기로 함
   5. third party 재인증 요청 -> 리프레시 토큰을 관리하는 요구사항 들은 리프레시 토큰을 요청하여 토큰을 다시 발급 받을 수 있게 해야함. 로그인 가드와 다르게 리프레시 가드를 따로 두어야함?
   6. third party 로그아웃 요청 -> 엑세스 토큰을 발급하고 저장하지 않고 정보를 요청하고 끝내는 경우. 로그아웃 시켜줘야하는지?&#x20;
